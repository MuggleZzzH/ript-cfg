MASTER_PORT=$(python -c "import socket; s=socket.socket(); s.bind(('', 0)); print(s.getsockname()[1]); s.close()")
NCCL_TIMEOUT=108000 torchrun --nproc_per_node=$1  --master_port=$MASTER_PORT  train_ript.py --config-name=train_prior_rl.yaml \
  exp_name=quest_success_90_tasks \
  variant_name=LIBERO_90_ppo_epoch_20_ppo_batch_6_rloo_8_demo_batch_180_stop_0.8_dynamic_sampling\
  reward_function=success \
  train_dataloader.batch_size=180 \
  train_dataloader.shuffle=true \
  algo.dataset.pad_seq_length=false \
  dataset.seq_len=600 \
  seed=0 \
  training.auto_continue=false \
  training.n_epochs=6 \
  training.save_interval=5 \
  checkpoint_path=FILL_IN_YOUR_CHECKPOINT_PATH_FROM_SFR_OR_RIPT \
  device=cuda \
  algo.rloo_batch_size=8 \
  algo.ppo_batch_size=1 \
  algo.num_ppo_epochs=20 \
  training.gradient_accumulation_steps=1 \
  training.grad_clip=1.0 \
  algo.lr=1e-6 \
  algo.policy.scheduler_factory.eta_min=1e-8 \
  rollout.enabled=true \
  rollout.interval=1 \
  rollout.rollouts_per_env=48 \
  task.task_names_to_use=['KITCHEN_SCENE10_close_the_top_drawer_of_the_cabinet','KITCHEN_SCENE10_close_the_top_drawer_of_the_cabinet_and_put_the_black_bowl_on_top_of_it','KITCHEN_SCENE10_put_the_black_bowl_in_the_top_drawer_of_the_cabinet','KITCHEN_SCENE10_put_the_butter_at_the_back_in_the_top_drawer_of_the_cabinet_and_close_it','KITCHEN_SCENE10_put_the_butter_at_the_front_in_the_top_drawer_of_the_cabinet_and_close_it','KITCHEN_SCENE10_put_the_chocolate_pudding_in_the_top_drawer_of_the_cabinet_and_close_it','KITCHEN_SCENE1_open_the_bottom_drawer_of_the_cabinet','KITCHEN_SCENE1_open_the_top_drawer_of_the_cabinet','KITCHEN_SCENE1_open_the_top_drawer_of_the_cabinet_and_put_the_bowl_in_it','KITCHEN_SCENE1_put_the_black_bowl_on_the_plate','KITCHEN_SCENE1_put_the_black_bowl_on_top_of_the_cabinet','KITCHEN_SCENE2_open_the_top_drawer_of_the_cabinet','KITCHEN_SCENE2_put_the_black_bowl_at_the_back_on_the_plate','KITCHEN_SCENE2_put_the_black_bowl_at_the_front_on_the_plate','KITCHEN_SCENE2_put_the_middle_black_bowl_on_the_plate','KITCHEN_SCENE2_put_the_middle_black_bowl_on_top_of_the_cabinet','KITCHEN_SCENE2_stack_the_black_bowl_at_the_front_on_the_black_bowl_in_the_middle','KITCHEN_SCENE2_stack_the_middle_black_bowl_on_the_back_black_bowl','KITCHEN_SCENE3_put_the_frying_pan_on_the_stove','KITCHEN_SCENE3_put_the_moka_pot_on_the_stove','KITCHEN_SCENE3_turn_on_the_stove','KITCHEN_SCENE3_turn_on_the_stove_and_put_the_frying_pan_on_it','KITCHEN_SCENE4_close_the_bottom_drawer_of_the_cabinet','KITCHEN_SCENE4_close_the_bottom_drawer_of_the_cabinet_and_open_the_top_drawer','KITCHEN_SCENE4_put_the_black_bowl_in_the_bottom_drawer_of_the_cabinet','KITCHEN_SCENE4_put_the_black_bowl_on_top_of_the_cabinet','KITCHEN_SCENE4_put_the_wine_bottle_in_the_bottom_drawer_of_the_cabinet','KITCHEN_SCENE4_put_the_wine_bottle_on_the_wine_rack','KITCHEN_SCENE5_close_the_top_drawer_of_the_cabinet','KITCHEN_SCENE5_put_the_black_bowl_in_the_top_drawer_of_the_cabinet','KITCHEN_SCENE5_put_the_black_bowl_on_the_plate','KITCHEN_SCENE5_put_the_black_bowl_on_top_of_the_cabinet','KITCHEN_SCENE5_put_the_ketchup_in_the_top_drawer_of_the_cabinet','KITCHEN_SCENE6_close_the_microwave','KITCHEN_SCENE6_put_the_yellow_and_white_mug_to_the_front_of_the_white_mug','KITCHEN_SCENE7_open_the_microwave','KITCHEN_SCENE7_put_the_white_bowl_on_the_plate','KITCHEN_SCENE7_put_the_white_bowl_to_the_right_of_the_plate','KITCHEN_SCENE8_put_the_right_moka_pot_on_the_stove','KITCHEN_SCENE8_turn_off_the_stove','KITCHEN_SCENE9_put_the_frying_pan_on_the_cabinet_shelf','KITCHEN_SCENE9_put_the_frying_pan_on_top_of_the_cabinet','KITCHEN_SCENE9_put_the_frying_pan_under_the_cabinet_shelf','KITCHEN_SCENE9_put_the_white_bowl_on_top_of_the_cabinet','KITCHEN_SCENE9_turn_on_the_stove','KITCHEN_SCENE9_turn_on_the_stove_and_put_the_frying_pan_on_it','LIVING_ROOM_SCENE1_pick_up_the_alphabet_soup_and_put_it_in_the_basket','LIVING_ROOM_SCENE1_pick_up_the_cream_cheese_box_and_put_it_in_the_basket','LIVING_ROOM_SCENE1_pick_up_the_ketchup_and_put_it_in_the_basket','LIVING_ROOM_SCENE1_pick_up_the_tomato_sauce_and_put_it_in_the_basket','LIVING_ROOM_SCENE2_pick_up_the_alphabet_soup_and_put_it_in_the_basket','LIVING_ROOM_SCENE2_pick_up_the_butter_and_put_it_in_the_basket','LIVING_ROOM_SCENE2_pick_up_the_milk_and_put_it_in_the_basket','LIVING_ROOM_SCENE2_pick_up_the_orange_juice_and_put_it_in_the_basket','LIVING_ROOM_SCENE2_pick_up_the_tomato_sauce_and_put_it_in_the_basket','LIVING_ROOM_SCENE3_pick_up_the_alphabet_soup_and_put_it_in_the_tray','LIVING_ROOM_SCENE3_pick_up_the_butter_and_put_it_in_the_tray','LIVING_ROOM_SCENE3_pick_up_the_cream_cheese_and_put_it_in_the_tray','LIVING_ROOM_SCENE3_pick_up_the_ketchup_and_put_it_in_the_tray','LIVING_ROOM_SCENE3_pick_up_the_tomato_sauce_and_put_it_in_the_tray','LIVING_ROOM_SCENE4_pick_up_the_black_bowl_on_the_left_and_put_it_in_the_tray','LIVING_ROOM_SCENE4_pick_up_the_chocolate_pudding_and_put_it_in_the_tray','LIVING_ROOM_SCENE4_pick_up_the_salad_dressing_and_put_it_in_the_tray','LIVING_ROOM_SCENE4_stack_the_left_bowl_on_the_right_bowl_and_place_them_in_the_tray','LIVING_ROOM_SCENE4_stack_the_right_bowl_on_the_left_bowl_and_place_them_in_the_tray','LIVING_ROOM_SCENE5_put_the_red_mug_on_the_left_plate','LIVING_ROOM_SCENE5_put_the_red_mug_on_the_right_plate','LIVING_ROOM_SCENE5_put_the_white_mug_on_the_left_plate','LIVING_ROOM_SCENE5_put_the_yellow_and_white_mug_on_the_right_plate','LIVING_ROOM_SCENE6_put_the_chocolate_pudding_to_the_left_of_the_plate','LIVING_ROOM_SCENE6_put_the_chocolate_pudding_to_the_right_of_the_plate','LIVING_ROOM_SCENE6_put_the_red_mug_on_the_plate','LIVING_ROOM_SCENE6_put_the_white_mug_on_the_plate','STUDY_SCENE1_pick_up_the_book_and_place_it_in_the_front_compartment_of_the_caddy','STUDY_SCENE1_pick_up_the_book_and_place_it_in_the_left_compartment_of_the_caddy','STUDY_SCENE1_pick_up_the_book_and_place_it_in_the_right_compartment_of_the_caddy','STUDY_SCENE1_pick_up_the_yellow_and_white_mug_and_place_it_to_the_right_of_the_caddy','STUDY_SCENE2_pick_up_the_book_and_place_it_in_the_back_compartment_of_the_caddy','STUDY_SCENE2_pick_up_the_book_and_place_it_in_the_front_compartment_of_the_caddy','STUDY_SCENE2_pick_up_the_book_and_place_it_in_the_left_compartment_of_the_caddy','STUDY_SCENE2_pick_up_the_book_and_place_it_in_the_right_compartment_of_the_caddy','STUDY_SCENE3_pick_up_the_book_and_place_it_in_the_front_compartment_of_the_caddy','STUDY_SCENE3_pick_up_the_book_and_place_it_in_the_left_compartment_of_the_caddy','STUDY_SCENE3_pick_up_the_book_and_place_it_in_the_right_compartment_of_the_caddy','STUDY_SCENE3_pick_up_the_red_mug_and_place_it_to_the_right_of_the_caddy','STUDY_SCENE3_pick_up_the_white_mug_and_place_it_to_the_right_of_the_caddy','STUDY_SCENE4_pick_up_the_book_in_the_middle_and_place_it_on_the_cabinet_shelf','STUDY_SCENE4_pick_up_the_book_on_the_left_and_place_it_on_top_of_the_shelf','STUDY_SCENE4_pick_up_the_book_on_the_right_and_place_it_on_the_cabinet_shelf','STUDY_SCENE4_pick_up_the_book_on_the_right_and_place_it_under_the_cabinet_shelf'] \
  task.env_runner.num_parallel_envs=2\
  training.n_steps=15\
  training.rollout_steps=3\
  algo.early_stop_porcentage=0.8\
  algo.enable_dynamic_sampling=true\
  algo.use_token_level_loss_avg=true

